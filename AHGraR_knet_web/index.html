<!DOCTYPE HTML>
<html>
   <head>
      <meta charset=utf-8 />
      <script type="text/javascript">
      // Global variables
      var project_id = "0";
      var wsconn = new WebSocket("ws://146.118.99.190:7687/");
      // Trigger load list of available projects
         window.onload = function(){
             LoadProjectList();
      };
         // Load list of available projects
         function LoadProjectList()
         {
            // Open websocket to retrieve list of projects
            //var wsconn = new WebSocket("ws://146.118.99.190:7687/");
            // Request project list
            wsconn.onopen = function () {wsconn.send("Project_List");};
            // Receive and process project list
            wsconn.onmessage = function (evt){SetProjectList(evt.data);};
         };
         // Fill select menu with available projects
         // Data comes from websocket "Project_List" command
         function SetProjectList(received_msg)
         {
            // Find select menu
            select_menu = document.getElementById("select_proj");
            // Each line of data contains one project
            // Each line has project name, project ID and project status
            project_items = received_msg.split("\n");
            // Iterate through project data
            for(var i = 0; i < project_items.length; i++)
            {
                 project_item = project_items[i].split("\t");
                 // Create a new select option
                 option = document.createElement("option");
                 // Fill select option with data:
                 option.innerHTML = project_item[0];
                 option.value = project_item[1];
                 // Add new option as child to select menu
                 select_menu.appendChild(option);
             };
             // Update global project ID variable
             changeProjectID();
             // Load project-specific list of species
             // LoadSpeciesList();
         };
         // Update the global project ID in response to either
         // changing the value in the project select menu
         // or on initial loading of the page
         function changeProjectID()
         {
            // Find select menu and retrieve currently selected project
            var select_menu = document.getElementById("select_proj");
            // Change global variable
            project_id = select_menu.options[select_menu.selectedIndex].value;
            console.log("New PI: "+project_id);
            // Load project-specific list of species
            LoadSpeciesList();
         }
         // Load list of species for this project
         function LoadSpeciesList()
         {
            // Open websocket to retrieve list of projects
            var wsconn = new WebSocket("ws://146.118.99.190:7687/");
            // Request species list
            wsconn.onopen = function () {wsconn.send("SL_"+project_id);};
            // Receive and process project list
            wsconn.onmessage = function (evt){
                console.log("Recv species msg");
                SetSpeciesList(evt.data);
                };
         }
          // Fill species select menu with available species
         // Data comes from websocket "SL" command
         function SetSpeciesList(received_msg)
         {
            console.log("SetSpeciesList");
            // Find select menu
            select_species_menu = document.getElementById("select_species");
            // Each line of data contains one species
            species_items = received_msg.split("\n");
            // Iterate through project data
            for(var i = 0; i < species_items.length; i++)
            {
                 // Create a new select option
                 option = document.createElement("option");
                 // Fill select option with data:
                 option.innerHTML = species_items[i];
                 option.value = species_items[i];
                 // Add new option as child to select menu
                 select_species_menu.appendChild(option);
             };
         }

      </script>
		
   </head>
   <body>
       <select id="select_proj" onChange="javascript:changeProjectID();">
       </select>
       <select id="select_species">
       </select>
       <select id="select_chromosome">
       </select>
       <input type="text" name="firstname">
       <select id="select_type">
            <option value="Both">Genes and Proteins</option>
            <option value="Gene">Genes only</option>
            <option value="Prot">Proteins only</option>
       </select>
        <button type="button">Search!</button>
   </body>
</html>
